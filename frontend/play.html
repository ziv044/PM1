<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM1 - Player Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet.js for interactive maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link rel="stylesheet" href="play/css/leaflet-theme.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'game-dark': '#0f0f1a',
                        'game-darker': '#080810',
                        'game-card': '#1a1a2e',
                        'game-border': '#2a2a4a',
                        'game-accent': '#4a9eff',
                        'game-success': '#22c55e',
                        'game-warning': '#f59e0b',
                        'game-danger': '#ef4444',
                        'game-purple': '#a855f7',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="play/css/play.css">
</head>
<body class="bg-game-darker text-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-game-dark border-b border-game-border px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-bold text-game-accent">PM1</h1>
            <span class="text-gray-400">|</span>
            <span class="text-gray-300">Player Command Center</span>
        </div>
        <div class="flex items-center gap-6">
            <!-- Game Time -->
            <div class="flex items-center gap-2">
                <span class="text-gray-400 text-sm">Game Time:</span>
                <span id="gameTime" class="font-mono text-game-accent">--:--:--</span>
            </div>
            <!-- Play/Pause Button -->
            <button id="playPauseBtn" class="flex items-center gap-2 px-4 py-1.5 rounded-lg bg-game-success hover:bg-game-success/80 text-white font-medium transition-all">
                <span id="playPauseIcon">&#9654;</span>
                <span id="playPauseText">Start</span>
            </button>
            <!-- Simulation Status -->
            <div id="simStatus" class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-gray-500"></span>
                <span class="text-gray-400 text-sm">Stopped</span>
            </div>
            <!-- Alert Level -->
            <div id="alertLevel" class="hidden px-3 py-1 rounded-full text-sm font-medium bg-game-danger/20 text-game-danger">
                ALERT: HIGH
            </div>
            <!-- Game Menu Button -->
            <button id="gameMenuBtn" class="p-2 rounded hover:bg-game-border text-gray-400 hover:text-gray-200 transition-colors" title="Game Menu">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="p-4 grid grid-cols-12 gap-4 h-[calc(100vh-60px-200px)]">
        <!-- Left Column: KPIs -->
        <aside id="kpiPanel" class="col-span-3 bg-game-dark rounded-lg border border-game-border overflow-hidden flex flex-col">
            <div class="px-4 py-3 border-b border-game-border bg-game-card">
                <h2 class="font-semibold text-gray-200">Israel Status</h2>
            </div>
            <div class="flex-1 overflow-y-auto p-4 space-y-4" id="kpiContent">
                <!-- KPI categories will be injected here -->
                <div class="text-gray-500 text-sm text-center py-8">Loading KPIs...</div>
            </div>
        </aside>

        <!-- Center Column: Events Feed -->
        <section id="eventsPanel" class="col-span-5 bg-game-dark rounded-lg border border-game-border overflow-hidden flex flex-col">
            <div class="px-4 py-3 border-b border-game-border bg-game-card flex items-center justify-between">
                <h2 class="font-semibold text-gray-200">Events Feed</h2>
                <div class="flex items-center gap-2">
                    <span id="eventCount" class="text-xs text-gray-400">0 events</span>
                    <button id="filterEventsBtn" class="text-xs px-2 py-1 rounded bg-game-border hover:bg-game-accent/20 text-gray-300">
                        Filter
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto" id="eventsContent">
                <!-- Events will be injected here -->
                <div class="text-gray-500 text-sm text-center py-8">Loading events...</div>
            </div>
        </section>

        <!-- Right Column: Tactical Map -->
        <aside id="mapPanel" class="col-span-4 bg-game-dark rounded-lg border border-game-border overflow-hidden flex flex-col">
            <div class="px-4 py-3 border-b border-game-border bg-game-card flex items-center justify-between">
                <h2 class="font-semibold text-gray-200">Tactical Map</h2>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400">Fog of War: ON</span>
                </div>
            </div>
            <div class="flex-1 relative" id="mapContent">
                <!-- Map SVG will be injected here -->
                <div class="absolute inset-0 flex items-center justify-center text-gray-500 text-sm">
                    Loading map...
                </div>
            </div>
            <!-- Map Legend -->
            <div class="px-4 py-2 border-t border-game-border bg-game-card flex items-center gap-4 text-xs">
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded-full bg-game-accent"></span>
                    <span class="text-gray-400">Friendly</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded-full bg-game-danger opacity-50"></span>
                    <span class="text-gray-400">Enemy (Intel)</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="w-3 h-3 rounded bg-game-warning"></span>
                    <span class="text-gray-400">Event</span>
                </div>
            </div>
        </aside>
    </main>

    <!-- Bottom Section: Entity Tabs -->
    <section id="entityPanel" class="fixed bottom-0 left-0 right-0 h-[200px] bg-game-dark border-t border-game-border">
        <!-- Entity Category Tabs -->
        <div class="flex items-center gap-1 px-4 py-2 border-b border-game-border bg-game-card overflow-x-auto">
            <button class="entity-tab active px-4 py-2 rounded-t text-sm font-medium bg-game-dark text-game-accent border-t border-x border-game-border" data-category="security">
                Security Services
            </button>
            <button class="entity-tab px-4 py-2 rounded-t text-sm font-medium text-gray-400 hover:text-gray-200" data-category="government">
                Government
            </button>
            <button class="entity-tab px-4 py-2 rounded-t text-sm font-medium text-gray-400 hover:text-gray-200" data-category="media">
                Media
            </button>
            <button class="entity-tab px-4 py-2 rounded-t text-sm font-medium text-gray-400 hover:text-gray-200" data-category="international">
                International Allies
            </button>
        </div>
        <!-- Entity Cards Container -->
        <div class="p-4 overflow-x-auto" id="entityContent">
            <div class="flex gap-4" id="entityCards">
                <!-- Entity cards will be injected here -->
                <div class="text-gray-500 text-sm">Loading agents...</div>
            </div>
        </div>
    </section>

    <!-- PM Decision Modal (hidden by default) -->
    <div id="pmDecisionModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg max-w-lg w-full mx-4 shadow-2xl">
            <div class="px-6 py-4 border-b border-game-border bg-game-danger/10">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">&#9888;</span>
                    <div>
                        <h3 class="font-bold text-lg text-game-danger">PM DECISION REQUIRED</h3>
                        <p class="text-sm text-gray-400">Simulation paused - awaiting your decision</p>
                    </div>
                </div>
            </div>
            <div class="p-6" id="pmDecisionContent">
                <!-- Decision content will be injected here -->
            </div>
            <div class="px-6 py-4 border-t border-game-border flex justify-end gap-3" id="pmDecisionActions">
                <!-- Decision buttons will be injected here -->
            </div>
        </div>
    </div>

    <!-- Event Filter Modal (hidden by default) -->
    <div id="filterModal" class="fixed inset-0 bg-black/60 z-40 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg w-80 mx-4 shadow-xl">
            <div class="px-4 py-3 border-b border-game-border">
                <h3 class="font-semibold">Filter Events</h3>
            </div>
            <div class="p-4 space-y-3">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="event-filter rounded" data-type="military" checked>
                    <span class="text-sm">Military Operations</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="event-filter rounded" data-type="diplomatic" checked>
                    <span class="text-sm">Diplomatic Actions</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="event-filter rounded" data-type="intelligence" checked>
                    <span class="text-sm">Intelligence Reports</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" class="event-filter rounded" data-type="media" checked>
                    <span class="text-sm">Media & Public</span>
                </label>
            </div>
            <div class="px-4 py-3 border-t border-game-border flex justify-end">
                <button id="closeFilterBtn" class="px-4 py-2 bg-game-accent text-white rounded hover:bg-game-accent/80 text-sm">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <!-- Game Menu Modal -->
    <div id="gameMenuModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg w-80 mx-4 shadow-2xl">
            <div class="px-4 py-3 border-b border-game-border flex items-center justify-between">
                <h3 class="font-semibold text-gray-200">Game Menu</h3>
                <button id="closeGameMenuBtn" class="text-gray-400 hover:text-gray-200 text-xl leading-none">&times;</button>
            </div>
            <div class="p-4 space-y-4">
                <div class="text-center">
                    <p class="text-xs text-gray-400">Current Game</p>
                    <p id="currentGameDisplay" class="font-medium text-game-accent">Loading...</p>
                    <p id="currentGameTime" class="text-xs text-gray-400 mt-1">--</p>
                    <p class="text-xs text-game-success mt-2">Auto-saved</p>
                </div>
                <div class="flex gap-2">
                    <button id="newGameBtn" class="flex-1 px-3 py-2 rounded bg-game-accent hover:bg-game-accent/80 text-white text-sm font-medium">
                        + New Game
                    </button>
                    <button id="loadGameBtn" class="flex-1 px-3 py-2 rounded bg-game-border hover:bg-game-border/80 text-gray-200 text-sm font-medium">
                        Load Game
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Game Modal -->
    <div id="newGameModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg w-96 mx-4 shadow-2xl">
            <div class="px-4 py-3 border-b border-game-border flex items-center justify-between">
                <h3 class="font-semibold text-gray-200">New Game</h3>
                <button id="closeNewGameBtn" class="text-gray-400 hover:text-gray-200 text-xl leading-none">&times;</button>
            </div>
            <div class="p-4 space-y-4">
                <p class="text-sm text-gray-400">Start a fresh October 7th scenario.</p>
                <div>
                    <label class="block text-sm text-gray-300 mb-1">Save Name</label>
                    <input id="newGameNameInput" type="text"
                        class="w-full bg-game-card border border-game-border rounded px-3 py-2 text-gray-200 focus:outline-none focus:border-game-accent"
                        placeholder="My Campaign">
                </div>
                <div class="flex gap-2">
                    <button id="cancelNewGameBtn" class="flex-1 px-3 py-2 rounded bg-game-border text-gray-200 text-sm">
                        Cancel
                    </button>
                    <button id="createGameBtn" class="flex-1 px-3 py-2 rounded bg-game-success hover:bg-game-success/80 text-white text-sm font-medium">
                        Create & Start
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Game Modal -->
    <div id="loadGameModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg w-96 mx-4 shadow-2xl max-h-[80vh] flex flex-col">
            <div class="px-4 py-3 border-b border-game-border flex items-center justify-between">
                <h3 class="font-semibold text-gray-200">Load Game</h3>
                <button id="closeLoadGameBtn" class="text-gray-400 hover:text-gray-200 text-xl leading-none">&times;</button>
            </div>
            <div class="p-4 flex-1 overflow-y-auto">
                <p class="text-xs text-gray-400 mb-3">Simulation must be stopped to load a different game.</p>
                <div id="gamesListContainer" class="space-y-2">
                    <p class="text-gray-400 text-center py-4">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PM Instructions Modal -->
    <div id="pmInstructionsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-game-dark border border-game-border rounded-lg w-[500px] mx-4 shadow-2xl max-h-[80vh] flex flex-col">
            <div class="px-4 py-3 border-b border-game-border flex items-center justify-between bg-game-card">
                <div class="flex items-center gap-3">
                    <span id="pmInstructionsAgentAvatar" class="text-2xl">&#128100;</span>
                    <div>
                        <h3 class="font-semibold text-gray-200">PM Directive</h3>
                        <p id="pmInstructionsAgentName" class="text-sm text-gray-400">Agent Name</p>
                    </div>
                </div>
                <button id="closePMInstructionsBtn" class="text-gray-400 hover:text-gray-200 text-xl leading-none">&times;</button>
            </div>
            <div class="p-4 flex-1 overflow-y-auto space-y-4">
                <!-- Current Instructions (if any) -->
                <div id="currentInstructionsSection" class="hidden">
                    <label class="block text-xs text-gray-400 mb-1">Current Directive</label>
                    <div id="currentInstructionsDisplay" class="bg-game-card border border-game-border rounded p-3 text-sm text-gray-300 italic"></div>
                </div>

                <!-- Input Section -->
                <div>
                    <label class="block text-sm text-gray-300 mb-1">Your Instructions</label>
                    <textarea id="pmInstructionsInput"
                        class="w-full h-24 bg-game-card border border-game-border rounded px-3 py-2 text-gray-200 focus:outline-none focus:border-game-accent resize-none"
                        placeholder="Give your directive to this agent... (e.g., 'Focus on hostage rescue operations. Coordinate with IDF before any major decisions.')"></textarea>
                    <p class="text-xs text-gray-500 mt-1">Your instructions will be summarized and added to the agent's directives.</p>
                </div>

                <!-- Preview Section (shows after summarize) -->
                <div id="pmInstructionsPreview" class="hidden">
                    <label class="block text-xs text-gray-400 mb-1">Summarized Directive (Preview)</label>
                    <div id="pmInstructionsSummary" class="bg-game-accent/10 border border-game-accent/30 rounded p-3 text-sm text-game-accent"></div>
                </div>
            </div>
            <div class="px-4 py-3 border-t border-game-border flex justify-end gap-2">
                <button id="cancelPMInstructionsBtn" class="px-4 py-2 rounded bg-game-border text-gray-200 text-sm hover:bg-game-border/80">
                    Cancel
                </button>
                <button id="summarizePMInstructionsBtn" class="px-4 py-2 rounded bg-game-accent text-white text-sm font-medium hover:bg-game-accent/80">
                    Summarize
                </button>
                <button id="applyPMInstructionsBtn" class="hidden px-4 py-2 rounded bg-game-success text-white text-sm font-medium hover:bg-game-success/80">
                    Apply Directive
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="play/js/api-adapter.js"></script>
    <script src="play/js/player-state.js"></script>
    <script src="play/js/components/events-feed.js"></script>
    <script src="play/js/components/kpi-panel.js"></script>
    <script src="play/js/components/entity-panel.js"></script>
    <script src="play/js/components/region-data.js"></script>
    <script src="play/js/components/tactical-map.js"></script>
    <script src="play/js/components/pm-decisions.js"></script>
    <script src="play/js/play-app.js"></script>
</body>
</html>
