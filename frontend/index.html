<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM1 Agent Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gray-800 text-white flex flex-col">
            <div class="p-4 border-b border-gray-700">
                <h1 class="text-xl font-bold">PM1 Admin</h1>
            </div>

            <div class="p-4">
                <button id="addAgentBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded flex items-center justify-center gap-2">
                    <span>+</span> Add Agent
                </button>
                <div class="flex gap-2 mt-2">
                    <button id="enableAllBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-1 px-2 rounded text-xs">
                        Enable All
                    </button>
                    <button id="disableAllBtn" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-1 px-2 rounded text-xs">
                        Disable All
                    </button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-4">
                <h2 class="text-sm uppercase text-gray-400 mb-2">Agents</h2>
                <div id="agentList" class="space-y-2">
                    <!-- Agent cards will be rendered here -->
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow px-6 py-4 flex items-center justify-between">
                <h2 id="agentTitle" class="text-xl font-semibold text-gray-800">Select an Agent</h2>
                <div id="agentActions" class="hidden space-x-2">
                    <button id="deleteAgentBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm">Delete</button>
                </div>
            </header>

            <!-- Tabs -->
            <div id="tabsContainer" class="hidden bg-white border-b px-6">
                <nav class="flex space-x-4">
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="details">Details</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="skills">Skills</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="memory">Memory</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="chat">Chat</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="simulation">Simulation</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="mapstate">Map State</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="logs">Logs</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="debug">Debug Console</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="pmapprovals">PM Approvals</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="meetings">Meetings</button>
                    <button class="tab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-tab="kpis">KPIs</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Empty State -->
                <div id="emptyState" class="flex items-center justify-center h-full text-gray-400">
                    <div class="text-center">
                        <svg class="mx-auto h-16 w-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <p>Select an agent or create a new one</p>
                    </div>
                </div>

                <!-- Details Tab -->
                <div id="detailsTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                        <form id="inlineEditForm">
                            <!-- Agent ID - Read-only -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Agent ID</label>
                                <p id="detailAgentId" class="text-gray-900 font-mono bg-gray-100 p-2 rounded"></p>
                            </div>

                            <!-- Model - Editable -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                <select id="detailModel" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                                    <option value="claude-opus-4-20250514">Claude Opus 4</option>
                                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                                    <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                                </select>
                            </div>

                            <!-- System Prompt - Editable -->
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">System Prompt (Stored)</label>
                                <textarea id="detailSystemPrompt" rows="6"
                                    class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-mono"
                                    placeholder="Enter system prompt..."></textarea>
                            </div>

                            <!-- Simulation Properties -->
                            <div class="border-t pt-4 mt-4">
                                <h4 class="font-medium text-gray-700 mb-3">Simulation Properties</h4>

                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Entity Type</label>
                                        <select id="detailEntityType" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="System">System</option>
                                            <option value="Entity">Entity</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Event Frequency (min)</label>
                                        <input type="number" id="detailEventFrequency" min="1" value="60"
                                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Agent Category</label>
                                    <select id="detailAgentCategory" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">-- Select Category --</option>
                                        <option value="Security Services">Security Services</option>
                                        <option value="Government Services">Government Services</option>
                                        <option value="Media">Media</option>
                                        <option value="International Affairs">International Affairs</option>
                                        <option value="Enemies">Enemies</option>
                                    </select>
                                </div>

                                <div class="flex flex-wrap gap-4 mb-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="detailIsEnabled" class="mr-2">
                                        <span class="text-sm text-gray-700 font-medium">Enabled</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="detailIsEnemy" class="mr-2">
                                        <span class="text-sm text-gray-700">Is Enemy</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="detailIsWest" class="mr-2">
                                        <span class="text-sm text-gray-700">Is West</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="detailIsEvilAxis" class="mr-2">
                                        <span class="text-sm text-gray-700">Is Evil Axis</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" id="detailIsReportingGovernment" class="mr-2">
                                        <span class="text-sm text-gray-700">Reports to Government</span>
                                    </label>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Agenda</label>
                                    <textarea id="detailAgenda" rows="2"
                                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        placeholder="Enter agent agenda..."></textarea>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Primary Objectives</label>
                                    <textarea id="detailPrimaryObjectives" rows="3"
                                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        placeholder="Enter primary objectives (one per line)..."></textarea>
                                </div>

                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Hard Rules</label>
                                    <textarea id="detailHardRules" rows="3"
                                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        placeholder="Enter hard rules (one per line)..."></textarea>
                                </div>
                            </div>

                            <!-- Save/Cancel buttons -->
                            <div class="flex justify-end gap-2 mt-6 pt-4 border-t">
                                <button type="button" id="cancelInlineEditBtn"
                                    class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">
                                    Cancel
                                </button>
                                <button type="submit" id="saveInlineEditBtn"
                                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Prompts Display Section -->
                    <div class="bg-white rounded-lg shadow p-6 max-w-2xl mt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium text-gray-800">Agent Prompts</h3>
                            <button id="refreshPromptsBtn"
                                class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                                Refresh
                            </button>
                        </div>

                        <!-- Compiled System Prompt -->
                        <div class="mb-4">
                            <button type="button" id="toggleCompiledPromptBtn"
                                class="w-full flex justify-between items-center bg-blue-50 hover:bg-blue-100 p-3 rounded-t cursor-pointer">
                                <span class="font-medium text-blue-700">Compiled System Prompt</span>
                                <span class="text-blue-500 text-sm" id="compiledPromptToggleIcon">+ Expand</span>
                            </button>
                            <div id="compiledPromptSection" class="hidden border border-t-0 border-blue-200 rounded-b p-4 bg-blue-50/50">
                                <p class="text-xs text-gray-500 mb-2">Auto-generated from agent category, alignment flags, agenda, objectives, and rules.</p>
                                <pre id="displayCompiledPrompt" class="text-sm bg-white p-3 rounded border max-h-64 overflow-y-auto whitespace-pre-wrap font-mono"></pre>
                            </div>
                        </div>

                        <!-- Full Action Prompt -->
                        <div class="mb-4">
                            <button type="button" id="toggleActionPromptBtn"
                                class="w-full flex justify-between items-center bg-green-50 hover:bg-green-100 p-3 rounded-t cursor-pointer">
                                <span class="font-medium text-green-700">Full Action Prompt (Simulation)</span>
                                <span class="text-green-500 text-sm" id="actionPromptToggleIcon">+ Expand</span>
                            </button>
                            <div id="actionPromptSection" class="hidden border border-t-0 border-green-200 rounded-b p-4 bg-green-50/50">
                                <p class="text-xs text-gray-500 mb-2">
                                    Dynamic prompt sent to LLM during simulation. Includes memory, location context, and game time.
                                </p>

                                <!-- Game Time Badge -->
                                <div class="mb-3 flex items-center gap-2">
                                    <span class="text-xs bg-green-200 text-green-800 px-2 py-1 rounded">Game Time:</span>
                                    <span id="promptGameTime" class="text-sm font-mono">--</span>
                                </div>

                                <!-- Context Summary -->
                                <div class="grid grid-cols-3 gap-2 mb-3 text-xs">
                                    <div class="bg-white p-2 rounded border">
                                        <span class="text-gray-500">Memory Entries:</span>
                                        <span id="promptMemoryCount" class="font-medium ml-1">0</span>
                                    </div>
                                    <div class="bg-white p-2 rounded border">
                                        <span class="text-gray-500">Location:</span>
                                        <span id="promptLocationSummary" class="font-medium ml-1">--</span>
                                    </div>
                                    <div class="bg-white p-2 rounded border">
                                        <span class="text-gray-500">Intel Access:</span>
                                        <span id="promptIntelAccess" class="font-medium ml-1">--</span>
                                    </div>
                                </div>

                                <!-- Full Prompt Display -->
                                <pre id="displayActionPrompt" class="text-sm bg-white p-3 rounded border max-h-96 overflow-y-auto whitespace-pre-wrap font-mono"></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Skills Tab -->
                <div id="skillsTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">Skills</h3>
                            <button id="addSkillBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">+ Add Skill</button>
                        </div>
                        <div id="skillsList" class="space-y-2">
                            <!-- Skills will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Memory Tab -->
                <div id="memoryTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">Memory</h3>
                            <button id="addMemoryBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">+ Add Memory</button>
                        </div>
                        <div id="memoryList" class="space-y-2">
                            <!-- Memory items will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Chat Tab -->
                <div id="chatTab" class="tab-content hidden h-full flex flex-col">
                    <div class="bg-white rounded-lg shadow flex-1 flex flex-col max-w-3xl">
                        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                            <!-- Chat messages will be rendered here -->
                        </div>
                        <div class="border-t p-4">
                            <div class="flex gap-2">
                                <input type="text" id="chatInput" placeholder="Type a message..."
                                    class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button id="sendChatBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">Send</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simulation Tab -->
                <div id="simulationTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6 max-w-3xl">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium">Simulation Control</h3>
                            <div class="flex gap-2">
                                <button id="startSimBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                                    Start
                                </button>
                                <button id="stopSimBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded" disabled>
                                    Stop
                                </button>
                            </div>
                        </div>

                        <!-- Status Panel -->
                        <div class="bg-gray-100 p-4 rounded mb-6">
                            <div class="grid grid-cols-4 gap-4 mb-4">
                                <div>
                                    <span class="text-sm text-gray-500">Status</span>
                                    <p id="simStatus" class="font-medium text-red-600">Stopped</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-500">Game Clock</span>
                                    <p id="simClock" class="font-mono">--</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-500">Entities</span>
                                    <p id="simEntityCount" class="font-medium">0</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-500">Clock Speed</span>
                                    <div class="flex items-center gap-2">
                                        <input type="number" id="clockSpeedInput" value="2" min="0.1" max="60" step="0.1"
                                            class="w-16 border rounded px-2 py-1 text-sm">
                                        <span class="text-xs text-gray-600">sec/min</span>
                                        <button id="updateClockSpeedBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs">Set</button>
                                    </div>
                                </div>
                            </div>
                            <!-- Game Time Controls -->
                            <div class="border-t pt-4 mt-2">
                                <div class="flex items-center gap-4">
                                    <div>
                                        <span class="text-sm text-gray-500 block mb-1">Set Game Time</span>
                                        <div class="flex items-center gap-2">
                                            <input type="datetime-local" id="gameTimeInput"
                                                class="border rounded px-2 py-1 text-sm"
                                                value="2023-10-07T06:29">
                                            <button id="setGameTimeBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-xs">Set Time</button>
                                        </div>
                                    </div>
                                    <div class="ml-auto">
                                        <button id="saveSimStateBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm">
                                            Save State
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Event Log -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-medium">Event Log</h4>
                                <div class="flex gap-2 items-center">
                                    <span id="eventCount" class="text-sm text-gray-500">0 events</span>
                                    <button id="resolveNowBtn" class="bg-orange-600 hover:bg-orange-700 text-white text-sm px-3 py-1 rounded">
                                        Resolve Pending
                                    </button>
                                    <button id="refreshEventsBtn" class="text-blue-600 hover:text-blue-700 text-sm">
                                        Refresh
                                    </button>
                                </div>
                            </div>
                            <div id="eventLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-xs max-h-96 overflow-y-auto">
                                <p class="text-gray-500">No events yet. Start the simulation to generate events.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Map State Tab -->
                <div id="mapstateTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium">Map State Overview</h3>
                            <button id="refreshMapStateBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                                Refresh
                            </button>
                        </div>

                        <!-- Summary Cards -->
                        <div class="grid grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded">
                                <span class="text-sm text-blue-600">Static Locations</span>
                                <p id="mapLocationsCount" class="text-2xl font-bold text-blue-800">0</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded">
                                <span class="text-sm text-green-600">Tracked Entities</span>
                                <p id="mapEntitiesCount" class="text-2xl font-bold text-green-800">0</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded">
                                <span class="text-sm text-purple-600">Active Events</span>
                                <p id="mapEventsCount" class="text-2xl font-bold text-purple-800">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <span class="text-sm text-gray-600">Valid Zones</span>
                                <p id="mapZonesCount" class="text-2xl font-bold text-gray-800">0</p>
                            </div>
                        </div>

                        <!-- Tracked Entities Section -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-700 mb-3">Tracked Entities</h4>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Category</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Owner</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Zone</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Detection</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="mapEntitiesTable" class="bg-white divide-y divide-gray-200">
                                        <!-- Entities will be rendered here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Static Locations Section -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-700 mb-3">Static Locations</h4>
                            <div class="grid grid-cols-3 gap-3" id="mapLocationsGrid">
                                <!-- Locations will be rendered here -->
                            </div>
                        </div>

                        <!-- Active Geo Events Section -->
                        <div class="mb-6">
                            <h4 class="font-medium text-gray-700 mb-3">Active Geo Events</h4>
                            <div id="mapEventsContainer" class="space-y-2">
                                <p class="text-gray-400 text-sm">No active events</p>
                            </div>
                        </div>

                        <!-- Move Entity Modal Trigger -->
                        <div id="moveEntitySection" class="hidden border-t pt-4 mt-4">
                            <h4 class="font-medium text-gray-700 mb-3">Move Entity</h4>
                            <div class="flex gap-4 items-end">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Entity</label>
                                    <select id="moveEntitySelect" class="border rounded px-3 py-2 text-sm">
                                        <!-- Populated dynamically -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Destination Zone</label>
                                    <select id="moveDestZoneSelect" class="border rounded px-3 py-2 text-sm">
                                        <!-- Populated dynamically -->
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Travel Time (min)</label>
                                    <input type="number" id="moveTravelTime" value="30" min="1" class="border rounded px-3 py-2 text-sm w-20">
                                </div>
                                <button id="moveEntityBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">
                                    Start Movement
                                </button>
                                <button id="teleportEntityBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm">
                                    Teleport
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logsTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">Application Logs</h3>
                            <button id="refreshLogsBtn" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Refresh</button>
                        </div>
                        <pre id="logsContent" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-xs overflow-x-auto max-h-96 overflow-y-auto"></pre>
                    </div>
                </div>

                <!-- Debug Console Tab -->
                <div id="debugTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow">
                        <!-- Debug Sub-tabs -->
                        <div class="border-b px-4">
                            <nav class="flex space-x-4">
                                <button class="debug-subtab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-blue-600 text-blue-600" data-subtab="gameflow">Game Flow</button>
                                <button class="debug-subtab-btn px-4 py-3 text-gray-600 hover:text-blue-600 border-b-2 border-transparent" data-subtab="agenttest">Agents Test</button>
                            </nav>
                        </div>

                        <!-- Game Flow Sub-tab -->
                        <div id="gameflowSubtab" class="debug-subtab-content p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium">Game Flow - Agent Activity</h3>
                                <div class="flex gap-2">
                                    <select id="gameflowAgentFilter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                                        <option value="">All Agents</option>
                                    </select>
                                    <select id="gameflowTypeFilter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                                        <option value="">All Types</option>
                                        <option value="chat">Chat</option>
                                        <option value="simulation">Simulation</option>
                                        <option value="memory">Memory</option>
                                        <option value="function">Function</option>
                                    </select>
                                    <button id="clearGameflowBtn" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Clear</button>
                                    <button id="refreshGameflowBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Refresh</button>
                                </div>
                            </div>

                            <!-- Activity Timeline -->
                            <div id="gameflowTimeline" class="bg-gray-900 text-gray-100 p-4 rounded font-mono text-xs max-h-[600px] overflow-y-auto">
                                <p class="text-gray-500">No activity recorded yet. Interact with agents to see the flow.</p>
                            </div>

                            <!-- Stats Panel -->
                            <div class="mt-4 grid grid-cols-4 gap-4">
                                <div class="bg-gray-100 p-3 rounded">
                                    <span class="text-sm text-gray-500">Total Calls</span>
                                    <p id="statsTotalCalls" class="text-xl font-medium">0</p>
                                </div>
                                <div class="bg-gray-100 p-3 rounded">
                                    <span class="text-sm text-gray-500">Active Agents</span>
                                    <p id="statsActiveAgents" class="text-xl font-medium">0</p>
                                </div>
                                <div class="bg-gray-100 p-3 rounded">
                                    <span class="text-sm text-gray-500">Avg Response Time</span>
                                    <p id="statsAvgTime" class="text-xl font-medium">--</p>
                                </div>
                                <div class="bg-gray-100 p-3 rounded">
                                    <span class="text-sm text-gray-500">Errors</span>
                                    <p id="statsErrors" class="text-xl font-medium text-red-600">0</p>
                                </div>
                            </div>
                        </div>

                        <!-- Agents Test Sub-tab -->
                        <div id="agenttestSubtab" class="debug-subtab-content hidden p-6">
                            <div class="grid grid-cols-3 gap-6">
                                <!-- Agent Selection & Info -->
                                <div class="col-span-1">
                                    <h3 class="text-lg font-medium mb-4">Select Agent</h3>
                                    <select id="testAgentSelect" class="w-full border border-gray-300 rounded px-3 py-2 mb-4">
                                        <option value="">-- Select an agent --</option>
                                    </select>

                                    <!-- Agent Info Panel -->
                                    <div id="testAgentInfo" class="bg-gray-100 p-4 rounded hidden">
                                        <h4 class="font-medium mb-2">Agent Info</h4>
                                        <div class="text-sm space-y-1">
                                            <p><span class="text-gray-500">Model:</span> <span id="testAgentModel">--</span></p>
                                            <p><span class="text-gray-500">Entity Type:</span> <span id="testAgentEntityType">--</span></p>
                                            <p><span class="text-gray-500">Category:</span> <span id="testAgentCategory">--</span></p>
                                        </div>
                                    </div>

                                    <!-- Quick Memory Injection -->
                                    <div class="mt-4">
                                        <h4 class="font-medium mb-2">Inject Memory</h4>
                                        <textarea id="testMemoryInput" rows="3" placeholder="Enter memory to inject..."
                                            class="w-full border border-gray-300 rounded px-3 py-2 text-sm mb-2"></textarea>
                                        <button id="injectMemoryBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded text-sm" disabled>
                                            Inject Memory
                                        </button>
                                    </div>

                                    <!-- Current Memory Display -->
                                    <div class="mt-4">
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-medium">Current Memory</h4>
                                            <button id="refreshTestMemoryBtn" class="text-blue-600 hover:text-blue-700 text-xs">Refresh</button>
                                        </div>
                                        <div id="testMemoryList" class="bg-gray-50 p-2 rounded text-xs max-h-40 overflow-y-auto">
                                            <p class="text-gray-400">Select an agent to view memory</p>
                                        </div>
                                    </div>

                                    <!-- Clear Conversation -->
                                    <div class="mt-4">
                                        <button id="clearTestConversationBtn" class="w-full bg-red-100 hover:bg-red-200 text-red-700 py-2 rounded text-sm" disabled>
                                            Clear Conversation History
                                        </button>
                                    </div>
                                </div>

                                <!-- Test Chat Interface -->
                                <div class="col-span-2 flex flex-col">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-medium">Test Chat</h3>
                                        <div class="flex items-center gap-4 text-sm">
                                            <label class="flex items-center gap-2">
                                                <span class="text-gray-500">Max Tokens:</span>
                                                <input type="number" id="testMaxTokens" value="1024" min="1" max="4096"
                                                    class="w-20 border border-gray-300 rounded px-2 py-1">
                                            </label>
                                            <label class="flex items-center gap-2">
                                                <span class="text-gray-500">Temp:</span>
                                                <input type="number" id="testTemperature" value="1.0" min="0" max="2" step="0.1"
                                                    class="w-16 border border-gray-300 rounded px-2 py-1">
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Chat Display -->
                                    <div id="testChatMessages" class="flex-1 bg-gray-50 border rounded p-4 overflow-y-auto max-h-[400px] mb-4">
                                        <p class="text-gray-400 text-center">Select an agent and start testing</p>
                                    </div>

                                    <!-- Chat Input -->
                                    <div class="flex gap-2">
                                        <input type="text" id="testChatInput" placeholder="Type a test message..."
                                            class="flex-1 border border-gray-300 rounded-lg px-4 py-2" disabled>
                                        <button id="sendTestChatBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg" disabled>
                                            Send
                                        </button>
                                    </div>

                                    <!-- Response Info -->
                                    <div id="testResponseInfo" class="mt-2 text-xs text-gray-500 hidden">
                                        <span>Last response: </span>
                                        <span id="testResponseTime">--</span>ms |
                                        <span id="testResponseTokens">--</span> tokens
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PM Approvals Tab -->
                <div id="pmapprovalsTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium">PM Approval Queue</h3>
                            <div class="flex gap-2 items-center">
                                <span id="pendingApprovalsCount" class="text-sm text-gray-500">0 pending</span>
                                <button id="refreshApprovalsBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                                    Refresh
                                </button>
                            </div>
                        </div>

                        <!-- Urgency Legend -->
                        <div class="flex gap-4 mb-4 text-xs">
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-red-500"></span> Immediate</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-orange-500"></span> High</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-blue-500"></span> Normal</span>
                            <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-gray-400"></span> Low</span>
                        </div>

                        <!-- Approval Cards Container -->
                        <div id="pmApprovalsContainer" class="space-y-4">
                            <p class="text-gray-400 text-center py-8">No pending approval requests</p>
                        </div>

                        <!-- Scheduled Events Section -->
                        <div class="border-t mt-6 pt-6">
                            <h4 class="font-medium text-gray-700 mb-3">Scheduled Events</h4>
                            <div id="scheduledEventsContainer" class="space-y-2">
                                <p class="text-gray-400 text-sm">No scheduled events</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPIs Tab -->
                <div id="kpisTab" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-medium">Entity KPIs</h3>
                            <div class="flex gap-2 items-center">
                                <span id="kpiLastUpdated" class="text-sm text-gray-500">Last updated: --</span>
                                <button id="refreshKpisBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">
                                    Refresh
                                </button>
                            </div>
                        </div>

                        <!-- KPI Entity Cards (Collapsible) -->
                        <div id="kpiEntitiesContainer" class="space-y-4">
                            <p class="text-gray-400 text-center py-8">Loading KPIs...</p>
                        </div>

                        <!-- KPI Change Log Section -->
                        <div class="border-t mt-6 pt-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-medium text-gray-700">KPI Change Log</h4>
                                <select id="kpiLogEntityFilter" class="border border-gray-300 rounded px-3 py-1 text-sm">
                                    <option value="">All Entities</option>
                                    <option value="Israel">Israel</option>
                                    <option value="Hamas">Hamas</option>
                                    <option value="USA">USA</option>
                                    <option value="Iran">Iran</option>
                                    <option value="Egypt">Egypt</option>
                                </select>
                            </div>
                            <div id="kpiChangeLog" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-xs max-h-64 overflow-y-auto">
                                <p class="text-gray-500">No KPI changes recorded yet.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Meetings Tab -->
                <div id="meetingsTab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column: Schedule Meeting -->
                        <div class="lg:col-span-1 space-y-4">
                            <!-- Schedule New Meeting Panel -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-medium mb-4">Schedule Meeting</h3>

                                <!-- Meeting Type Selection -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Meeting Type</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button class="meeting-type-btn p-3 border rounded hover:bg-blue-50 text-center transition-colors"
                                                data-type="cabinet_war_room">
                                            <span class="block text-xl mb-1">üèõÔ∏è</span>
                                            <span class="text-xs">Cabinet War Room</span>
                                        </button>
                                        <button class="meeting-type-btn p-3 border rounded hover:bg-blue-50 text-center transition-colors"
                                                data-type="negotiation">
                                            <span class="block text-xl mb-1">ü§ù</span>
                                            <span class="text-xs">Negotiation</span>
                                        </button>
                                        <button class="meeting-type-btn p-3 border rounded hover:bg-blue-50 text-center transition-colors"
                                                data-type="leader_talk">
                                            <span class="block text-xl mb-1">üåê</span>
                                            <span class="text-xs">Leader Talk</span>
                                        </button>
                                        <button class="meeting-type-btn p-3 border rounded hover:bg-blue-50 text-center transition-colors"
                                                data-type="agent_briefing">
                                            <span class="block text-xl mb-1">üí¨</span>
                                            <span class="text-xs">Agent Briefing</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Meeting Title -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                    <input type="text" id="meetingTitle"
                                        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        placeholder="Meeting title...">
                                </div>

                                <!-- Participant Selection -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Participants</label>
                                    <select id="meetingParticipantsSelect" multiple
                                        class="w-full border border-gray-300 rounded px-3 py-2 h-24 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                        <!-- Populated dynamically -->
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">Ctrl+click to select multiple</p>
                                </div>

                                <!-- Agenda Items -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Agenda Items</label>
                                    <div id="agendaItems" class="space-y-2">
                                        <input type="text" class="agenda-item w-full border border-gray-300 rounded px-3 py-2 text-sm"
                                            placeholder="Topic 1...">
                                    </div>
                                    <button id="addAgendaItemBtn" class="text-blue-600 text-sm mt-2 hover:underline">+ Add Item</button>
                                </div>

                                <!-- Schedule Button -->
                                <button id="scheduleMeetingBtn"
                                    class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors">
                                    Schedule Meeting
                                </button>
                            </div>
                        </div>

                        <!-- Right Column: Meetings List -->
                        <div class="lg:col-span-2 space-y-4">
                            <!-- Meeting Requests (from AI/System) -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-medium">Meeting Requests</h3>
                                    <span id="meetingRequestsCount" class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">0</span>
                                </div>
                                <div id="meetingRequestsList" class="space-y-3">
                                    <p class="text-gray-400 text-sm">No pending meeting requests.</p>
                                </div>
                            </div>

                            <!-- Scheduled Meetings -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-medium">Scheduled Meetings</h3>
                                    <button id="refreshMeetingsBtn" class="text-blue-600 text-sm hover:underline">Refresh</button>
                                </div>
                                <div id="scheduledMeetingsList" class="space-y-3">
                                    <p class="text-gray-400 text-sm">No scheduled meetings.</p>
                                </div>
                            </div>

                            <!-- Active Meeting Indicator -->
                            <div id="activeMeetingPanel" class="bg-green-50 border border-green-200 rounded-lg shadow p-6 hidden">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-medium text-green-800">Meeting In Progress</h3>
                                    <span class="bg-green-600 text-white text-xs px-2 py-1 rounded-full animate-pulse">LIVE</span>
                                </div>
                                <div id="activeMeetingInfo" class="mb-4">
                                    <p id="activeMeetingTitle" class="font-semibold"></p>
                                    <p id="activeMeetingType" class="text-sm text-gray-600"></p>
                                </div>
                                <button id="openMeetingRoomBtn" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700 transition-colors">
                                    Open Meeting Room
                                </button>
                            </div>

                            <!-- Meeting History -->
                            <div class="bg-white rounded-lg shadow p-6">
                                <h3 class="text-lg font-medium mb-4">Recent Meetings</h3>
                                <div id="meetingHistoryList" class="space-y-2 max-h-48 overflow-y-auto">
                                    <p class="text-gray-400 text-sm">No concluded meetings yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PM Modify Modal -->
    <div id="pmModifyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg mx-4">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4">Modify Approval Request</h3>
                <form id="pmModifyForm">
                    <input type="hidden" id="modifyApprovalId">

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Original Request</label>
                        <p id="modifyOriginalSummary" class="text-gray-600 bg-gray-100 p-2 rounded text-sm"></p>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Modified Summary</label>
                        <textarea id="modifyNewSummary" rows="3"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Enter modified summary..."></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">PM Notes</label>
                        <textarea id="modifyNotes" rows="2"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                            placeholder="Optional notes..."></textarea>
                    </div>

                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Schedule Execution (Optional)</label>
                        <input type="datetime-local" id="modifyDueTime"
                            class="border border-gray-300 rounded px-3 py-2 text-sm">
                        <p class="text-xs text-gray-500 mt-1">Leave empty for immediate execution after approval</p>
                    </div>

                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelModifyBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded">Approve Modified</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Agent Modal -->
    <div id="agentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 id="modalTitle" class="text-lg font-semibold mb-4">Add Agent</h3>
                <form id="agentForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Agent ID</label>
                        <input type="text" id="formAgentId" required
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                        <select id="formModel" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                            <option value="claude-opus-4-20250514">Claude Opus 4</option>
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="claude-3-5-haiku-20241022">Claude 3.5 Haiku</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">System Prompt</label>
                        <textarea id="formSystemPrompt" rows="4"
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="You are a helpful assistant..."></textarea>
                    </div>

                    <!-- Simulation Properties -->
                    <div class="border-t pt-4 mt-4">
                        <h4 class="font-medium text-gray-700 mb-3">Simulation Properties</h4>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Entity Type</label>
                                <select id="formEntityType" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="System">System</option>
                                    <option value="Entity">Entity</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Event Frequency (minutes)</label>
                                <input type="number" id="formEventFrequency" value="60" min="1"
                                    class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Agent Category</label>
                            <select id="formAgentCategory" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">-- Select Category --</option>
                                <option value="Security Services">Security Services</option>
                                <option value="Government Services">Government Services</option>
                                <option value="Media">Media</option>
                                <option value="International Affairs">International Affairs</option>
                                <option value="Enemies">Enemies</option>
                            </select>
                        </div>

                        <div class="flex flex-wrap gap-4 mb-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="formIsEnabled" class="mr-2" checked>
                                <span class="text-sm text-gray-700 font-medium">Enabled</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="formIsEnemy" class="mr-2">
                                <span class="text-sm text-gray-700">Is Enemy</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="formIsWest" class="mr-2">
                                <span class="text-sm text-gray-700">Is West</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="formIsEvilAxis" class="mr-2">
                                <span class="text-sm text-gray-700">Is Evil Axis</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="formIsReportingGovernment" class="mr-2">
                                <span class="text-sm text-gray-700">Reports to Government</span>
                            </label>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Agenda</label>
                            <textarea id="formAgenda" rows="2"
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Agent's overall agenda..."></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Primary Objectives</label>
                            <textarea id="formPrimaryObjectives" rows="3"
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="1. First objective&#10;2. Second objective"></textarea>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hard Rules</label>
                            <textarea id="formHardRules" rows="3"
                                class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Constraints the agent must follow..."></textarea>
                        </div>
                    </div>

                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelModalBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div id="skillModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4">Add Skill</h3>
                <form id="skillForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Skill Name</label>
                        <input type="text" id="formSkill" required
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g., code_generation">
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelSkillBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Memory Modal -->
    <div id="memoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-4">Add Memory</h3>
                <form id="memoryForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Memory Item</label>
                        <textarea id="formMemory" rows="3" required
                            class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter memory context..."></textarea>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button type="button" id="cancelMemoryBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm mx-4">
            <div class="p-6">
                <h3 class="text-lg font-semibold mb-2">Delete Agent</h3>
                <p class="text-gray-600 mb-4">Are you sure you want to delete this agent? This action cannot be undone.</p>
                <div class="flex justify-end gap-2">
                    <button id="cancelDeleteBtn" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
                    <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Room Modal (Full-screen overlay) -->
    <div id="meetingRoomModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50">
        <div class="flex h-full">
            <!-- Left Panel: Participants & Status -->
            <div class="w-64 bg-gray-800 text-white p-4 flex flex-col">
                <h3 id="meetingRoomTitle" class="font-bold mb-2 text-lg">Meeting</h3>
                <p id="meetingRoomType" class="text-sm text-gray-400 mb-4"></p>

                <!-- Round Counter -->
                <div class="mb-4 p-2 bg-gray-700 rounded text-center">
                    <span class="text-sm text-gray-400">Round</span>
                    <span id="meetingRoomRound" class="text-xl font-bold ml-2">1</span>
                    <span class="text-gray-400">/</span>
                    <span id="meetingRoomMaxRounds" class="text-gray-400">10</span>
                </div>

                <!-- Participants -->
                <div class="flex-1 overflow-y-auto">
                    <h4 class="text-sm text-gray-400 mb-2 uppercase tracking-wider">Participants</h4>
                    <div id="meetingRoomParticipants" class="space-y-2">
                        <!-- Participant cards rendered here -->
                    </div>
                </div>

                <!-- Agenda Progress -->
                <div class="border-t border-gray-600 pt-4 mt-4">
                    <h4 class="text-sm text-gray-400 mb-2 uppercase tracking-wider">Agenda</h4>
                    <div id="meetingRoomAgenda" class="space-y-1 text-sm max-h-32 overflow-y-auto">
                        <!-- Agenda items with checkmarks -->
                    </div>
                </div>

                <!-- Meeting Controls -->
                <div class="border-t border-gray-600 pt-4 mt-4 space-y-2">
                    <button id="advanceRoundBtn" class="w-full bg-green-600 hover:bg-green-700 py-2 rounded text-sm transition-colors">
                        Advance Round
                    </button>
                    <button id="concludeMeetingBtn" class="w-full bg-yellow-600 hover:bg-yellow-700 py-2 rounded text-sm transition-colors">
                        Conclude Meeting
                    </button>
                    <button id="abortMeetingBtn" class="w-full bg-red-600 hover:bg-red-700 py-2 rounded text-sm transition-colors">
                        Abort Meeting
                    </button>
                </div>
            </div>

            <!-- Center: Conversation Transcript -->
            <div class="flex-1 flex flex-col bg-white">
                <!-- Header -->
                <div class="p-4 border-b bg-gray-50">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-sm text-gray-500">Current Topic: </span>
                            <span id="meetingCurrentTopic" class="font-medium">General discussion</span>
                        </div>
                        <div class="text-sm text-gray-500">
                            <span id="meetingTurnCount">0</span> turns
                        </div>
                    </div>
                </div>

                <!-- Transcript -->
                <div id="meetingTranscript" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <p class="text-gray-400 text-center py-8">Meeting transcript will appear here...</p>
                </div>

                <!-- PM Input Section -->
                <div class="border-t p-4 bg-gray-50">
                    <div class="flex gap-2 mb-2">
                        <select id="pmActionType" class="border rounded px-3 py-2 text-sm bg-white">
                            <option value="statement">Statement</option>
                            <option value="question">Question</option>
                            <option value="proposal">Proposal</option>
                            <option value="decision">Decision</option>
                            <option value="demand">Demand</option>
                        </select>
                        <select id="pmTone" class="border rounded px-3 py-2 text-sm bg-white">
                            <option value="calm">Calm</option>
                            <option value="firm">Firm</option>
                            <option value="conciliatory">Conciliatory</option>
                            <option value="urgent">Urgent</option>
                        </select>
                        <select id="pmAddressedTo" class="border rounded px-3 py-2 text-sm bg-white flex-1">
                            <option value="">To: Everyone</option>
                            <!-- Populated with participants -->
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <textarea id="pmMeetingInput" rows="2"
                            class="flex-1 border rounded p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Enter your statement as PM..."></textarea>
                        <button id="submitPmMeetingInput" class="bg-blue-600 hover:bg-blue-700 text-white px-6 rounded transition-colors">
                            Speak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Context & Intelligence -->
            <div class="w-80 bg-gray-100 p-4 overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-medium">Meeting Intelligence</h4>
                    <button id="closeMeetingRoomBtn" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>

                <!-- Current State Summary -->
                <div class="bg-white p-3 rounded shadow-sm mb-4">
                    <h5 class="text-sm font-medium text-gray-500 mb-2">Current State</h5>
                    <p id="meetingStateSummary" class="text-sm text-gray-700">
                        Meeting has just begun.
                    </p>
                </div>

                <!-- Participant Positions -->
                <div class="bg-white p-3 rounded shadow-sm mb-4">
                    <h5 class="text-sm font-medium text-gray-500 mb-2">Positions</h5>
                    <div id="participantPositions" class="space-y-2 text-sm">
                        <!-- Position summaries per participant -->
                    </div>
                </div>

                <!-- Meeting Stakes -->
                <div class="bg-white p-3 rounded shadow-sm">
                    <h5 class="text-sm font-medium text-gray-500 mb-2">Stakes</h5>
                    <p id="meetingStakes" class="text-sm text-gray-700">
                        --
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Meeting Outcome Modal -->
    <div id="meetingOutcomeModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-4">Meeting Concluded</h2>

                <!-- Outcome Type Banner -->
                <div id="outcomeTypeBanner" class="p-4 rounded mb-4 text-center">
                    <span id="outcomeTypeText" class="font-bold text-lg"></span>
                </div>

                <!-- Outcome Summary -->
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Summary</h3>
                    <p id="outcomeSummary" class="text-gray-700 bg-gray-50 p-3 rounded"></p>
                </div>

                <!-- Agreements Section -->
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Agreements Reached</h3>
                    <div id="outcomeAgreements" class="space-y-2">
                        <p class="text-gray-400 text-sm">No agreements reached.</p>
                    </div>
                </div>

                <!-- Commitments Section -->
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Commitments Made</h3>
                    <div id="outcomeCommitments" class="space-y-2">
                        <p class="text-gray-400 text-sm">No commitments made.</p>
                    </div>
                </div>

                <!-- Events Generated -->
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Events Generated</h3>
                    <div id="outcomeEvents" class="text-sm text-gray-600">
                        <p class="text-gray-400">No events generated.</p>
                    </div>
                </div>

                <button id="closeMeetingOutcomeBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/components.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
